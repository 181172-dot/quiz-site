<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">

  <div class="card">
    <h2>ğŸ” ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <input id="id" placeholder="ID">
    <input id="pw" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button class="btn-main" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  </div>

  <div class="card">
    <h3>â• å•é¡Œã‚’è¿½åŠ </h3>
    <input id="qname" placeholder="å•é¡Œåï¼ˆä¾‹ï¼šç¬¬1å•ï¼‰">
    <button class="btn-main" onclick="addBtn()">è¿½åŠ </button>
  </div>

  <div id="buttons"></div>

  <div class="card">
    <button class="btn-danger" onclick="hide()">å…¨ä½“ã‚’éè¡¨ç¤º</button>
  </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

function login(){
  socket.emit("login",{id:id.value,pw:pw.value});
}

socket.on("loginOK",()=>alert("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ"));
socket.on("loginNG",()=>alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—"));

function addBtn(){
  socket.emit("addButton",{id:Date.now().toString(),name:qname.value});
}

socket.on("buttons", btns=>{
  const area=document.getElementById("buttons");
  area.innerHTML="";
  for(const id in btns){
    area.innerHTML+=`
      <div class="card problem">
        <div>
          <h4>${btns[id].name}</h4>
          <input type="file" multiple onchange="upload(event,'${id}')">
        </div>
        <div class="problem-actions">
          <button class="btn-main" onclick="show('${id}')">è¡¨ç¤º</button>
          <button class="btn-danger" onclick="del('${id}')">å‰Šé™¤</button>
        </div>
      </div>
    `;
  }
});

function upload(e,id){
  const fd=new FormData();
  for(const f of e.target.files) fd.append("images",f);
  fetch("/upload",{method:"POST",body:fd})
    .then(r=>r.json())
    .then(urls=>socket.emit("addImages",{id,images:urls}));
}
function show(id){ socket.emit("show",id); }
function del(id){ socket.emit("deleteButton",id); }
function hide(){ socket.emit("hide"); }
</script>
</body>
</html>
