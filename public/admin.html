<!DOCTYPE html>
<html>
<body>
<h2>管理者ログイン</h2>

<input id="id" placeholder="ID">
<input id="pw" type="password" placeholder="PW">
<button onclick="login()">ログイン</button>

<hr>

<h3>問題追加</h3>
<input id="qname" placeholder="問題名">
<button onclick="addBtn()">追加</button>

<div id="buttons"></div>

<hr>
<button onclick="hide()">非表示</button>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let currentId = null;

function login(){
  socket.emit("login",{id:id.value,pw:pw.value});
}
socket.on("loginOK",()=>alert("ログイン成功"));
socket.on("loginNG",()=>alert("失敗"));

function addBtn(){
  const id = Date.now().toString();
  socket.emit("addButton",{id,name:qname.value});
}

socket.on("buttons", btns=>{
  const div=document.getElementById("buttons");
  div.innerHTML="";
  for(const id in btns){
    div.innerHTML+=`
      <h4>${btns[id].name}</h4>
      <input type="file" multiple onchange="upload(event,'${id}')">
      <button onclick="show('${id}')">表示</button>
      <button onclick="del('${id}')">削除</button>
      <hr>
    `;
  }
});

function upload(e,id){
  const fd=new FormData();
  for(const f of e.target.files) fd.append("images",f);
  fetch("/upload",{method:"POST",body:fd})
    .then(r=>r.json())
    .then(urls=>{
      socket.emit("addImages",{id,images:urls});
    });
}
function show(id){ socket.emit("show",id); }
function del(id){ socket.emit("deleteButton",id); }
function hide(){ socket.emit("hide"); }
</script>
</body>
</html>
